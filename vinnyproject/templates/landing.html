{% extends "staticpage.html" %}

{% load i18n static %}

{% block content_title %}
    {% trans "WELCOME TO VINNY" %}
{% endblock %}

{% block header_nav %}{% endblock %}

{% block content_body %}
    {% blocktrans %}
    <p>Vinny is your buddy in the used car business, watching your back so you don't get ripped off.
       Within seconds, he will tell you the wholesale price of that car you are interested in buying.</p>
    <p>Simply scan the VIN barcode on the drivers side door (or enter manually), and then smile when talking to the dealer.
       Now you have actual market prices in your hand.</p>
    <p>Negotiate with confidence.</p>
    {% endblocktrans %}
{% endblock %}

{% block content_link %}
    <a href='#'><img src="{% static "site/img/button_app_store.png" %}" alt="App Store" /></a>
    <a href='#'><img src="{% static "site/img/button_google_play.png" %}" alt="Google Play" /></a>
    <div class="pull-right">
        <a href="#youtube-modal" data-toggle="modal"><img src="{% static "site/img/button_watch_video.png" %}" alt="Watch Video" /></a>
    </div>
{% endblock %}

{% block extra_script %}{{ block.super }}
<script type="text/javascript">
    // Youtube player controller
    var tag = document.createElement('script');
    tag.src = "//www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var player;
    var playerIsReady = false;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('youtube-player', {
            height: '360',
            width: '640',
            videoId: 'nDzYrYRy24U',
            events: {
                onReady: function(event) {
                    playerIsReady = true;
                },
            },
        });
    }

    // Auto start/stop Youtube when show and/hide modal
    $(function() {
        $('#youtube-modal').on('shown', function() {
            if (playerIsReady) player.seekTo(0);
        });
        $('#youtube-modal').on('hide', function() {
            if (playerIsReady) player.stopVideo();
        });
    });

    // Ajax login for class login-ajax
    $(function() {
        $('.login-ajax').click(function() {
            $.get($(this).data('url'), function(data) {
                var $loginOverlay = $('<div>')
                                        .modal({backdrop: true, keyboard: true})
                                        .appendTo('body');

                var loginSubmit = function() {
                    $(this).ajaxSubmit({
                        success: function(data) {
                            if (data.location)
                                window.location.href = data.location;
                            else
                                $loginOverlay.html(data.html)
                                             .find('form').submit(loginSubmit);
                        }
                    });
                    return false;
                };

                $loginOverlay.html(data.html)
                             .find('form').submit(loginSubmit);
            })
        });
        return false;
    });

    // Facebook connect button
    window.handleResponse = function(response, createUserUrl) {
        if (response.status == "connected") {
            var imageUrl = 'http://graph.facebook.com/' + response.authResponse.userID + '/picture';
            $('.content-avatar').html('<img src="'+ imageUrl + '" alt="" />')
            if (typeof createUserUrl !== "undefined" )
                $.post(createUserUrl, response.authResponse, function(data) {
                    console.log(data);
                })
        } else {
            $('.content-avatar').html('')
        }
    }

    window.fbAsyncInit = function() {
        FB.init({
            appId  : '{{ SETTINGS.FACEBOOK_APP_ID }}',
            status : true,
            cookie : true,
            xfbml  : true,
        });

        FB.getLoginStatus(function(response) {
            //console.log('FB.getLoginStatus');
            //console.log(response);
            handleResponse(response);
        });
    };

    (function(d){
         var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement('script'); js.id = id; js.async = true;
         js.src = "//connect.facebook.net/en_US/all.js";
         ref.parentNode.insertBefore(js, ref);
    }(document));
    
    $(function() {
        $('#facebook-connect').one('click', function() {
            var self = this;

            FB.Event.subscribe('auth.login', function (response) {
                //console.log("FB.Event.subscribe('auth.login')");
                //console.log(response);
                handleResponse(response, $(self).data('url'));
            });

            FB.Event.subscribe('auth.logout', function (response) {
                //console.log("FB.Event.subscribe('auth.logout')");
                //console.log(response);
                handleResponse(response);
            });
        }).click(function() {
            FB.login();
        });
    });
</script>
{% endblock %}
